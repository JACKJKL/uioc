!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.uioc=e.uioc||{})}(this,function(e){"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function n(e,t){-1===e.indexOf(t)&&e.push(t)}function r(e){return Object.prototype.toString.call(e)===l}function o(e){return e&&"object"===("undefined"==typeof e?"undefined":c["typeof"](e))&&"function"==typeof e.then}function i(){"undefined"!=typeof console&&Function.prototype.apply.call(console.warn,console,arguments)}function a(e){return r(e)&&"string"==typeof e.$ref}function s(e,t,n,r,o){var i=e.module;"function"!=typeof e.creator&&i&&(n[i]=n[i]||[],n[i].push(e)),t.processConfig(e.id);var a=r.checkForCircular(e.id);if(a){var u=e.id+" has circular dependencies ";throw new C(u,e)}r.addData(e);var c=r.appendChild(new v);o=o||e.argDeps.concat(e.propDeps).concat(e.setterDeps||[]);for(var l=o.length-1;l>-1;--l)t.hasComponent(o[l])&&s(t.getComponentConfig(o[l]),t,n,c);return n}function u(){return"function"==typeof define&&define.amd?require:"undefined"!=typeof module&&module&&"exports"in module?function(e,t){return t.apply(void 0,c.toConsumableArray(e.map(function(e){return require(e)})))}:void 0}var c={};c["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c["extends"]=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c.toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};var l=Object.prototype.toString.call({}),f={hasOwn:t,addToSet:n,isObject:r,isPromise:o,hasRef:a,warn:i},p=Symbol("store"),h=Symbol("getInstance"),y=function(){function e(t){c.classCallCheck(this,e),this.context=t,this[p]=Object.create(null)}return c.createClass(e,[{key:"createInstance",value:function(e){var t=this;if(!e)return Promise.resolve(null);switch(e.scope){case"singleton":var n=e.id;return n in this[p]||(this[p][n]=this[h](e).then(function(e){return t[p][n]=e})),Promise.resolve(this[p][n]);case"transient":return this[h](e);case"static":return Promise.resolve(e.creator)}}},{key:"injectArgs",value:function(e){var t=this,n=e.args;return Promise.all(n.map(function(e){return f.hasRef(e)?t.context.getComponent(e.$ref):e}))}},{key:"dispose",value:function(){var e=this[p];for(var t in e){var n=e[t];n&&"function"==typeof n.dispose&&n.dispose()}this[p]=null}},{key:h,value:function(e){return this.injectArgs(e).then(function(t){return e.creator.apply(e,c.toConsumableArray(t))})}}]),e}(),v=function(){function e(){c.classCallCheck(this,e),this.data=[],this.children=[],this.parent=null}return c.createClass(e,[{key:"appendChild",value:function(e){return e.parent=this,this.children.push(e),e}},{key:"checkForCircular",value:function(e){var t=this.parent;if(null!==t)for(var n=t.data,r=n.length-1;r>-1;--r)return t.data[r].id&&t.data[r].id===e?t.data[r]:t.checkForCircular(e);return null}},{key:"addData",value:function(e,t){return t&&this.checkForCircular(e.id)?!1:(this.data.push(e),!0)}}]),e}(),C=function(e){function t(e,n){c.classCallCheck(this,t);var r=c.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return r.component=n,r}return c.inherits(t,e),c.createClass(t,[{key:"print",value:function(){if("undefined"!=typeof console){var e;(e=console).warn.apply(e,arguments)}}}]),t}(Error),d=function(){function e(t){c.classCallCheck(this,e),this.amdLoader=u(),this.context=t}return c.createClass(e,[{key:"setLoaderFunction",value:function(e){this.amdLoader=e}},{key:"resolveDependentModules",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2];return s(e,this.context,t,new v,n)}},{key:"loadModuleMap",value:function(e){var t=this,n=Object.keys(e);return new Promise(function(r){t.amdLoader(n,function(){for(var o=arguments.length,i=Array(o),a=0;o>a;a++)i[a]=arguments[a];i.forEach(function(r,o){var i=n[o];e[i].forEach(function(e){return"function"!=typeof e.creator&&t.wrapCreator(e,r)})}),r()})})}},{key:"wrapCreator",value:function(e,t){var n=e.creator=e.creator||t;e.isFactory||"static"===e.scope||(e.creator=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(n,[null].concat(t)))})}}]),e}(),m=function(){function e(){c.classCallCheck(this,e)}return c.createClass(e,[{key:"onContainerInit",value:function(e,t){return t}},{key:"onAddComponent",value:function(e,t,n){return n}},{key:"onGetComponent",value:function(e,t,n){return n}},{key:"beforeCreateInstance",value:function(e,t,n){}},{key:"afterCreateInstance",value:function(e,t,n){return Promise.resolve(n)}},{key:"onContainerDispose",value:function(e){}},{key:"name",get:function(){throw new Error("need to be implement")}}]),e}(),g="^uioc-",b=Symbol("cache"),k=function(e){function t(){c.classCallCheck(this,t);var e=c.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e[b]=Object.create(null),e}return c.inherits(t,e),c.createClass(t,[{key:"name",get:function(){return"import"}}],[{key:"has",value:function(e){return f.isObject(e)&&"string"==typeof e.$import}},{key:"transformConfig",value:function(e,n){var r=n.args,o=null,i=r.reduce(function(i,a,s){return t.has(a)&&(o=t.createAnonymousConfig(e,a,n.id+"-$arg."+s+"."),r[s]={$ref:o},i.push(o)),i},[]),a=n.properties;for(var s in a)t.has(a[s])&&(o=t.createAnonymousConfig(e,a[s],n.id+"-$prop."+s+"."),a[s]={$ref:o},i.push(o));return i}},{key:"createAnonymousConfig",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],r=t.$import;if(!e.hasComponent(r))throw new Error("$import "+r+" component, but it is not exist, please check!!");var o=e.getComponentConfig(r);return t.id=(-1!==n.indexOf(g)?"":g)+n,t.$import=void 0,e.addComponent(t.id,c["extends"]({},o,t)),t.id}}]),c.createClass(t,[{key:"onGetComponent",value:function(e,n,r){return this[b][n]?r:(this[b][n]=t.transformConfig(e,r),r)}}]),t}(m),O=/^set[A-Z]/,P="set".length,j=Symbol("cache"),w=function(e){function t(){c.classCallCheck(this,t);var e=c.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e[j]=Object.create(null),e}return c.inherits(t,e),c.createClass(t,[{key:"name",get:function(){return"auto"}}],[{key:"getPropertyFromSetter",value:function(e,t){var n=null;return O.test(e)&&"function"==typeof t.value&&(n=e.charAt(P).toLowerCase()+e.slice(P+1)),n}},{key:"setProperty",value:function(e,t,n){var r="set"+t.charAt(0).toUpperCase()+t.slice(1);e[r](n)}}]),c.createClass(t,[{key:"afterCreateInstance",value:function(e,n,r){var o=this.resolveDependencies(e,n,r);return o.length?e.getComponent(o).then(function(e){return e.forEach(function(e,n){return t.setProperty(r,o[n],e)}),r}):Promise.resolve(r)}},{key:"resolveDependencies",value:function(e,n,r){if(this[j][n])return this[j][n];var o=e.getComponentConfig(n)||{};if(!o.auto)return this[j][n]=[],[];for(var i=o.properties||{},a=[],s=Object.create(null),u=function(n){var r=Object.getOwnPropertyNames(n);r.forEach(function(r){if(!s[r]){s[r]=!0;var o=Object.getOwnPropertyDescriptor(n,r);r=t.getPropertyFromSetter(r,o),r&&!f.hasOwn(i,r)&&e.hasComponent(r)&&a.push(r)}})},c=r;c;c=Object.getPrototypeOf(c))u(c);return this[j][n]=a,o.setterDeps=a,a}}]),t}(m),I=Symbol("cache"),A=function(e){function t(){c.classCallCheck(this,t);var e=c.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e[I]=Object.create(null),e}return c.inherits(t,e),c.createClass(t,[{key:"name",get:function(){return"property"}}],[{key:"getSetter",value:function(e){return f.isObject(e)&&"string"==typeof e.$setter?e.$setter:void 0}},{key:"setProperty",value:function(e,t,n,r){if(r)return e[r](n);var o="set"+t.charAt(0).toUpperCase()+t.slice(1);"function"==typeof e[o]?e[o](n):e[t]=n}}]),c.createClass(t,[{key:"afterCreateInstance",value:function(e,n,r){if(!e.hasComponent(n))return Promise.resolve(r);var o=e.getComponentConfig(n),i=this.resolveDependencies(e,n),a=o.properties;return e.getComponent(i).then(function(e){for(var n in a){var o=a[n],s=f.hasRef(o)?e[i.indexOf(o.$ref)]:o;t.setProperty(r,n,s,t.getSetter(o))}return r})}},{key:"resolveDependencies",value:function(e,t){if(this[I][t])return this[I][t];var n=this[I][t]=[],r=e.getComponentConfig(t),o=r.properties;for(var i in o){var a=o[i];f.hasRef(a)&&n.push(a.$ref)}return r.propDeps=n,n}}]),t}(m),D=Symbol("cache"),S=function(e){function t(){c.classCallCheck(this,t);var e=c.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e[D]=Object.create(null),e}return c.inherits(t,e),c.createClass(t,[{key:"name",get:function(){return"list"}}],[{key:"has",value:function(e){return f.isObject(e)&&e.$list instanceof Array}}]),c.createClass(t,[{key:"onContainerInit",value:function(e,t){return e.addComponent(this.constructor.LIST_ID,this.constructor.LIST_COMPONENT_CONFIG),t}},{key:"onGetComponent",value:function(e,n,r){if(this[D][n])return r;var o=this.constructor,i=o.has,a=o.LIST_ID;r.args=r.args.map(function(e){return i(e)?{$import:a,args:e.$list}:e});var s=r.properties;for(var u in s){var c=s[u];t.has(c)&&(s[u]={$import:a,args:c.$list})}return this[D][n]=!0,r}}]),t}(m);S.LIST_COMPONENT_CONFIG={creator:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return t},isFactory:!0},S.LIST_ID=Date.now()+"_list";var _=Symbol("cache"),$=function(e){function t(){c.classCallCheck(this,t);var e=c.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e[_]=Object.create(null),e}return c.inherits(t,e),c.createClass(t,[{key:"name",get:function(){return"map"}}],[{key:"has",value:function(e){return f.isObject(e)&&f.isObject(e.$map)}}]),c.createClass(t,[{key:"onContainerInit",value:function(e,t){return e.addComponent(this.constructor.MAP_ID,this.constructor.MAP_COMPONENT_CONFIG),t}},{key:"onGetComponent",value:function(e,n,r){if(this[_][n])return r;var o=this.constructor,i=o.has,a=o.MAP_ID;r.args=r.args.map(function(e){return i(e)?{$import:a,properties:e.$map}:e});var s=r.properties;for(var u in s){var c=s[u];t.has(c)&&(s[u]={$import:a,properties:c.$map})}return r}}]),t}(m);$.MAP_COMPONENT_CONFIG={creator:Object,isFactory:!0},$.MAP_ID=(new Date).getTime()+"_map";var F=function(e){function t(){return c.classCallCheck(this,t),c.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return c.inherits(t,e),c.createClass(t,[{key:"onContainerInit",value:function(e,t){return e.addComponent(this.constructor.AOP_ID,this.constructor.AOP_COMPONENT_CONFIG),t}},{key:"afterCreateInstance",value:function(e,t,n){var r=e.getComponentConfig(t)||{};return"aopConfig"in r?e.getComponent(this.constructor.AOP_ID).then(function(e){return(r.aopConfig.advisors||[]).reduce(function(t,n){var r=n.matcher,o=n.advices;return e.createObjectProxy(t,r,o)},n)}):Promise.resolve(n)}},{key:"name",get:function(){return"aop"}}]),t}(m);F.AOP_COMPONENT_CONFIG={module:"uaop",scope:"static"},F.AOP_ID=Symbol("internalAop");var E=Symbol("collection"),N=Symbol("components"),x=Symbol("createComponent"),M=Symbol("createInstance"),T=Symbol("loader"),R=Symbol("injector"),G={},L=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];c.classCallCheck(this,e),this[N]=Object.create(null),this[E]=new U([new S,new $,new k,new F,new A,new w]),this[E].addPlugins(t.plugins),this[T]=new d(this),this[R]=new y(this),t=this[E].onContainerInit(this,t),this.initConfig(t)}return c.createClass(e,[{key:"initConfig",value:function(e){e.loader&&this.setLoaderFunction(e.loader),this.addComponent(e.components||{})}},{key:"addComponent",value:function(e,t){if("object"!==("undefined"==typeof e?"undefined":c["typeof"](e))){if(this.hasComponent(e))throw new Error(String(e)+" has been added!");this[N][e]=this[x].call(this,e,t)}else for(var n in e)this.addComponent(n,e[n])}},{key:"getComponent",value:function(e){var t=this;if(e instanceof Array)return Promise.all(e.map(function(e){return t.getComponent(e)}));var n=Object.create(null);if(!this.hasComponent(e))return e=String(e),Promise.reject(new Error("`"+e+"` has not been added to the Ioc"));var r=this.getComponentConfig(e);this.processConfig(e);try{n=this[T].resolveDependentModules(r,n,r.argDeps)}catch(o){return Promise.reject(o)}return this[T].loadModuleMap(n).then(function(){return t[M](e)})}},{key:"hasComponent",value:function(e){return!!this[N][e]}},{key:"getComponentConfig",value:function(e){return e?this[N][e]:this[N]}},{key:"setLoaderFunction",value:function(e){this[T].setLoaderFunction(e)}},{key:"dispose",value:function(){this[E].onContainerDispose(this),this[R].dispose(),this[N]=null}},{key:"addPlugins",value:function(e,t){this[E].addPlugins(e,t)}},{key:"getPlugins",value:function(){return this[E].getPlugins()}},{key:"removePlugin",value:function(e){return this[E].removePlugin(e)}},{key:"processConfig",value:function(e){var t=this.getComponentConfig(e);if(t=this[E].onGetComponent(this,e,t),this[N][e]=t,!t.argDeps)for(var n=t.argDeps=[],r=t.args,o=r.length-1;o>-1;--o)f.hasRef(r[o])&&n.push(r[o].$ref)}},{key:x,value:function(e,t){t=this[E].onAddComponent(this,e,t);var n=c["extends"]({id:e,args:[],properties:{},argDeps:null,propDeps:null,setterDeps:null,scope:"transient",creator:null,module:void 0,isFactory:!1,auto:!1,instance:null},t);return"function"==typeof n.creator&&this[T].wrapCreator(n),n}},{key:M,value:function(e){var t=this;return this[E].beforeCreateInstance(this,e).then(function(n){if(n===G){var r=t.hasComponent(e)?t.getComponentConfig(e):null;return t[R].createInstance(r)}return n}).then(function(n){return t[E].afterCreateInstance(t,e,n)})}}]),e}(),q=Symbol("plugins"),U=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];c.classCallCheck(this,e),this[q]=t}return c.createClass(e,[{key:"onContainerInit",value:function(e,t){return this[q].reduce(function(t,n){return n.onContainerInit(e,t)},t)}},{key:"onAddComponent",value:function(e,t,n){return this[q].reduce(function(n,r){return r.onAddComponent(e,t,n)},n)}},{key:"onGetComponent",value:function(e,t,n){return this[q].reduce(function(n,r){return r.onGetComponent(e,t,n)},n)}},{key:"beforeCreateInstance",value:function(e,t){return this[q].reduce(function(n,r){return n.then(function(n){n=n===G?void 0:n;var o=r.beforeCreateInstance(e,t,n);return f.isPromise(o)?o:Promise.resolve(G)})},Promise.resolve(G))}},{key:"afterCreateInstance",value:function(e,t,n){return this[q].reduce(function(n,r){return n.then(function(n){var o=r.afterCreateInstance(e,t,n);return f.isPromise(o)?o:Promise.resolve(n)})},Promise.resolve(n))}},{key:"onContainerDispose",value:function(e){this[q].forEach(function(t){return t.onContainerDispose(e)})}},{key:"addPlugins",value:function(){var e,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=arguments.length<=1||void 0===arguments[1]?this[q].length:arguments[1];(e=this[q]).splice.apply(e,[n,0].concat(c.toConsumableArray(t)))}},{key:"getPlugins",value:function(){return this[q].slice(0)}},{key:"removePlugin",value:function(e){return"number"!=typeof e&&(e=this[q].indexOf(e),e=-1===e?this[q].length:e),!!this[q].splice(e,1).length}}]),e}();e.IoC=L,e.BasePlugin=m});
//# sourceMappingURL=bundle.js.map